<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Virtual Louvre</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('head-bob', {
        schema: {
          amplitude: {type: 'number', default: 0.05},
          speed: {type: 'number', default: 5},
          movingAmplitude: {type: 'number', default: 0.05},
          swayAmplitude: {type: 'number', default: 0.03},
          swaySpeed: {type: 'number', default: 2.5},
          randomSway: {type: 'number', default: 0.002},
          moveSpeed: {type: 'number', default: 1.2}
        },
        init: function () {
          this.el.addEventListener('componentchanged', this.onComponentChanged.bind(this));
          this.bobbing = false;
          this.moving = false;
          this.time = 0;
        },
        tick: function (time, timeDelta) {
          this.time += timeDelta / 1000;
          let position = this.el.getAttribute('position');
          let rotation = this.el.getAttribute('rotation');

          if (this.bobbing) {
            position.y = 1.6 + Math.sin(this.time * this.data.speed) * this.data.amplitude;
          } else if (this.moving) {
            position.y = 1.6 + Math.sin(this.time * this.data.speed) * this.data.movingAmplitude;
            position.x += Math.sin(this.time * this.data.swaySpeed) * this.data.swayAmplitude;
            position.z += Math.cos(this.time * this.data.swaySpeed) * this.data.swayAmplitude;

            rotation.y += (Math.random() - 0.5) * this.data.randomSway * timeDelta;
            this.el.setAttribute('rotation', rotation);

            const velocity = this.el.getAttribute('velocity');
            velocity.x *= this.data.moveSpeed;
            velocity.z *= this.data.moveSpeed;
            this.el.setAttribute('velocity', velocity);
          }
          this.el.setAttribute('position', position);
        },
        onComponentChanged: function (evt) {
          if (evt.detail.name === 'velocity') {
            const velocity = this.el.getAttribute('velocity');
            const speed = Math.sqrt(velocity.x * velocity.x + velocity.y * velocity.y + velocity.z * velocity.z);
            this.bobbing = speed < 0.1;
            this.moving = speed >= 0.1;
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <a-entity camera wasd-controls="acceleration: 20" look-controls position="0 1.6 0" head-bob>
        <a-entity cursor="fuse: true; fuseTimeout: 500"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color: black; shader: flat"></a-entity>
      </a-entity>
      
      <a-light type="ambient" color="#888"></a-light>
      <a-light type="directional" color="#FFF" intensity="0.5" position="1 1 0"></a-light>

      <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="20" color="#7BC8A4"></a-plane>
      
      <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
      <a-sphere position="1 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
      <a-cylinder position="0 0.75 -7" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
      <a-cone position="0 1 -10" radius-bottom="0.5" radius-top="0.2" height="2" color="#FFC65D"></a-cone>
    </a-scene>
  </body>
</html>
